<% layout("layout/boilerplate") %>

   <div class="row">
    <div class="col-8 offset-3 mt-2">
  
  <!-- LISTING -->

    <h3><%= listing.title %> </h3>
      </div>
   <div class="card col-6 offset-3 show-card">
   
  <img   src="<%= listing.image.url ? listing.image.url : listing.image %>" 
   class="card-img-top show-img mb-1 mt-1"
    alt="listing_image">
  
  <div class="card-body">
    <p class="card-text"> 
       <p><strong>Owner:</strong> <%= listing.owner.username %></p>
         <%= listing.description %><br/>
         &#8377; <%= listing.price ? listing.price.toLocaleString("en-IN") : "Price not available" %><br/>
         <%= listing.location %><br/>
         <%= listing.country %> <br/>
        
    </p>
  </div>
</div>
   </br>

<!-- BUTTONS -->

  <% if(currUser && listing.owner._id.equals(currUser._id)) { %>

   <div class="btns">
     <a 
     href ="/listings/<%=listing._id %>/edit"
    class="btn btn-dark col-2 offset-3 edit-btn">
    EDIT 
    </a>

   <form method="POST" action="/listings/<%=listing._id%>?_method=DELETE">
    <button  class="btn btn-dark offset-5">
      DELETE</button>
   </form>
   </div>
 <% }%>

<div class="col-8 offset-2 mb-3">
  <hr/>
  <!-- Review List Section -->
  <h4 class="mt-4">Reviews:</h4>
 

  <ul class="list-group">
    <% listing.reviews.forEach(review => { %>
      <li class="list-group-item"> <%= review.author.username %></li>
      <li class="list-group-item">
        ‚≠ê <strong><%= review.rating %>/5</strong><br>
        <%= review.comments %>

        
        <!-- Delete button for each review -->
         <div class="col-8 offset-0 mt-2 mb-1">
        <form method="POST" 
              action="/listings/<%= listing._id %>/reviews/<%= review._id %>?_method=DELETE"
              class="d-inline float-end">
          <button class="btn btn-sm btn-outline-danger">Delete</button>
        </form>
        </div>
      </li>
    <% }) %>
  </ul>

  <!-- Review Submission Form -->
  <form method="POST"
        action="/listings/<%= listing._id %>/reviews"
        novalidate 
        class="needs-validation mt-4">
   

   <fieldset class="starability-slot">
  <h6>First rating:</h6>
  <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]" value="0" checked aria-label="No rating." />
  <input type="radio" id="first-rate1" name="review[rating]"value="1" />
  <label for="first-rate1" title="Terrible">1 star</label>
  <input type="radio" id="first-rate2" name="review[rating]"value="2" />
  <label for="first-rate2" title="Not good">2 stars</label>
  <input type="radio" id="first-rate3" name="review[rating]"value="3" />
  <label for="first-rate3" title="Average">3 stars</label>
  <input type="radio" id="first-rate4" name="review[rating]"value="4" />
  <label for="first-rate4" title="Very good">4 stars</label>
  <input type="radio" id="first-rate5" name="review[rating]"value="5" />
  <label for="first-rate5" title="Amazing">5 stars</label>
</fieldset>


<script>
  const slider = document.getElementById('rating');
  const output = document.getElementById('ratingValue');
  slider.oninput = function () {
    output.textContent = this.value;
  };
</script>


    <div class="mb-3">
      <h6>Comments</h6>
      <textarea class="form-control" id="comments" name="review[comments]" rows="3" required></textarea>
    </div>

    <button class="btn btn-success">Submit Review</button>
   </form>

</div>
</div>

